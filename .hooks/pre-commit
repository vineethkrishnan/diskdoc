#!/bin/bash
set -e

# --- DiskDoctor Pre-commit Hook ---

# Source common profiles to ensure cargo is in PATH
[ -f "$HOME/.cargo/env" ] && . "$HOME/.cargo/env"
export PATH="$PATH:/usr/local/bin:/opt/homebrew/bin"

if ! command -v cargo &> /dev/null; then
    echo "âŒ Error: cargo command not found. Please ensure Rust is installed and in your PATH."
    exit 1
fi

echo "--- ğŸ› ï¸ Running Pre-commit Checks ---"

# 1. Formatting
echo "ğŸ¨ Checking formatting (cargo fmt)..."
cargo fmt --all -- --check

# 2. Linting
echo "ğŸ” Running linter (clippy)..."
cargo clippy --all-targets --all-features -- -D warnings

# 3. Testing
echo "ğŸ§ª Running tests (cargo test)..."
cargo test

echo "âœ… All checks passed! Proceeding with commit."
